ä»¥ä¸‹ã¯æŽ¨æ•²å¾Œã®Markdownæ–‡æ›¸ã§ã™ã€‚æ–‡ä½“ã®çµ±ä¸€ã€è¡¨ç¾ã®æ˜Žçž­åŒ–ã€ã‚¿ã‚¤ãƒã®ä¿®æ­£ã€èª­ç‚¹ãƒ»å¥èª­ç‚¹ã®æ•´ç†ã‚’ä¸­å¿ƒã«æ”¹å–„ã—ã¾ã—ãŸã€‚ãƒªãƒ³ã‚¯ã‚„ã‚³ãƒ¼ãƒ‰ã€æ§‹æˆã¯å…ƒã®ã¾ã¾ã§ã™ã€‚

---

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°æ‰‹é †æ›¸

[readmeã¸](../../README.md) | [doc.mdã¸](../doc.md)

## ç›®æ¬¡

0. [å³å¸­æ›´æ–°æ‰‹é †](#å³å¸­æ›´æ–°æ‰‹é †)
1. [æ¦‚è¦](#æ¦‚è¦)
2. [å‰ææ¡ä»¶](#å‰ææ¡ä»¶)
3. [æ›´æ–°ã®æµã‚Œ](#æ›´æ–°ã®æµã‚Œ)
4. [è©³ç´°æ‰‹é †](#è©³ç´°æ‰‹é †)
5. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

## å³å¸­æ›´æ–°æ‰‹é †

* `update/sample/`å†…ã®ã€æ›´æ–°ã—ãŸã„ãƒ†ãƒ¼ãƒ–ãƒ«åã®ã‚µãƒ³ãƒ—ãƒ«JSONã‚’`update/{table}/add/`ã«ç§»å‹•
* ç§»å‹•ã—ãŸJSONã«è¿½åŠ ã—ãŸã„å†…å®¹ã‚’è¿½è¨˜
* developãƒ–ãƒ©ãƒ³ãƒã«pushã—ã¦ã€Pull Requestã‚’ä½œæˆ
* ç®¡ç†è€…ãŒDBã‚’æ›´æ–°ï¼

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ã‚·ãƒ©ãƒã‚¹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ›´æ–°æ‰‹é †ã‚’èª¬æ˜Žã—ã¾ã™ã€‚
æ›´æ–°ã¯ã€JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰€å®šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã—ã€Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•ã™ã‚‹ã“ã¨ã§è¡Œã„ã¾ã™ã€‚
ä»¥ä¸‹ã®æ‰‹é †ã¯ã€å˜ãªã‚‹æ›´æ–°ã«ã¨ã©ã¾ã‚‰ãšã€æ›´æ–°å¾Œã®DBçŠ¶æ…‹ã¾ã§ç¢ºèªã—ãŸã„æ–¹å‘ã‘ã®å†…å®¹ã§ã™ã€‚

### ç›®çš„

* ã‚·ãƒ©ãƒã‚¹ãƒ‡ãƒ¼ã‚¿ã®å®‰å…¨ãªæ›´æ–°
* æ›´æ–°å±¥æ­´ã®è¨˜éŒ²
* ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®å¯¾å¿œç­–ã®æ˜Žç¤º

### ç‰¹å¾´

* JSONãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ç®¡ç†
* Dockerã«ã‚ˆã‚‹ç’°å¢ƒã®åˆ†é›¢
* æ‰‹å‹•ç¢ºèªã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®ç¢ºä¿

## å‰ææ¡ä»¶

### å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢

* Docker Desktop
* Python 3.8ä»¥ä¸Š
* Visual Studio Codeï¼ˆæŽ¨å¥¨ï¼‰

### å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«

* `.env.sample`ï¼ˆã¾ãŸã¯`.env`ï¼‰ãƒ•ã‚¡ã‚¤ãƒ«
* æ›´æ–°ç”¨JSONãƒ•ã‚¡ã‚¤ãƒ«

## æ›´æ–°ã®æµã‚Œ

1. ç’°å¢ƒã®æº–å‚™
2. JSONãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®
3. Dockerã‚³ãƒ³ãƒ†ãƒŠã®å†èµ·å‹•
4. æ›´æ–°ã®ç¢ºèª

## è©³ç´°æ‰‹é †

### 1. ç’°å¢ƒã®æº–å‚™

#### 1-1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¯ãƒ­ãƒ¼ãƒ³ï¼ˆåˆå›žã®ã¿ï¼‰

```bash
git clone https://github.com/yourusername/syllabus_backend.git
cd syllabus_backend
```

#### 1-2. ç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æº–å‚™

```bash
cd docker/postgresql
copy .env.sample .env
```

### 2. JSONãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®

#### 2-1. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®ç¢ºèª

```
updates/
â””â”€â”€ subject/
    â”œâ”€â”€ add/      # æ–°è¦è¿½åŠ ãƒ‡ãƒ¼ã‚¿
    â”œâ”€â”€ update/   # æ›´æ–°ãƒ‡ãƒ¼ã‚¿
    â””â”€â”€ delete/   # å‰Šé™¤ãƒ‡ãƒ¼ã‚¿
```

#### 2-2. JSONãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼

```json
{
  "content": {
    "subject_code": "AB1234",
    "subject_name": "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°åŸºç¤Ž",
    "credit": 2,
    "created_at": "2024-03-20T10:00:00",
    "updated_at": "2024-03-20T10:00:00"
  }
}
```

#### 2-3. ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®

* é©åˆ‡ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é¸æŠžï¼ˆadd / update / deleteï¼‰
* ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆä¾‹ï¼š`subject_001.json`ï¼‰ã§ä¿å­˜
* è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®åŒæ™‚é…ç½®ã‚‚å¯èƒ½

### 3. Dockerã‚³ãƒ³ãƒ†ãƒŠã®å†èµ·å‹•

#### 3-1. ç¾åœ¨ã®ã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢

```bash
cd docker/postgresql
docker compose down
```

#### 3-2. ã‚³ãƒ³ãƒ†ãƒŠã®å†èµ·å‹•

```bash
docker compose up -d
```

### 4. æ›´æ–°ã®ç¢ºèª

#### 4-1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®æŽ¥ç¶š

```bash
psql -h localhost -p 5432 -U admin_user -d syllabus_db
```

#### 4-2. ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª

```sql
SELECT * FROM subject WHERE updated_at > CURRENT_DATE - INTERVAL '1 day';
SELECT * FROM subject WHERE subject_code = 'AB1234';
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã‚¨ãƒ©ãƒ¼

#### 1. ãƒ­ã‚°ã®ç¢ºèª

```bash
docker logs postgresql-db
```

#### 2. ã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾ç­–

* **ãƒãƒ¼ãƒˆç«¶åˆ**

```bash
netstat -ano | findstr :5432
```

* **æ¨©é™ã‚¨ãƒ©ãƒ¼**

  * `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
  * Dockerã®å†èµ·å‹•

### ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¨ãƒ©ãƒ¼

* JSONãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã®ç¢ºèª

  * å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€æ—¥ä»˜å½¢å¼ã€æ–‡å­—ã‚³ãƒ¼ãƒ‰ï¼ˆUTF-8ï¼‰

* DBçŠ¶æ…‹ã®ç¢ºèª

```sql
\d subject
SELECT * FROM error_log ORDER BY created_at DESC LIMIT 10;
```

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã‚¢

```bash
docker exec postgresql-db pg_dump -U admin_user syllabus_db > backup_before_update.sql
cat backup_before_update.sql | docker exec -i postgresql-db psql -U admin_user -d syllabus_db
```

## è£œè¶³ï¼šãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```bash
python src/db/migrations/generate_migration.py
ls -l docker/postgresql/init/migrations/
```

ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•æ™‚ã«è‡ªå‹•é©ç”¨ã•ã‚Œã¾ã™ã€‚

---

## 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã®æ›´æ–°æ‰‹é †

### 1.1 ã‚¹ã‚­ãƒ¼ãƒžå¤‰æ›´ã®æµã‚Œ

1. **å¤‰æ›´å†…å®¹ã®ç¢ºèª**

   * `structure.md`ã¨ERå›³ã®æ›´æ–°ã€å½±éŸ¿ç¯„å›²ã®ç‰¹å®š

2. **ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ**

```bash
python generate_migration.py
```

3. **åˆæœŸåŒ–SQLã®æ›´æ–°**

```bash
./generate_init.sh
```

4. **ãƒ¢ãƒ‡ãƒ«ã®æ›´æ–°**

   * `models.py`ã¨å¿…è¦ã«å¿œã˜ã¦ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã‚‚ä¿®æ­£

5. **DBæ“ä½œé–¢æ•°ã®æ›´æ–°**

   * `database.py`ã®è©²å½“ç®‡æ‰€ã‚’ä¿®æ­£

6. **ã‚µãƒ³ãƒ—ãƒ«JSONã®æ›´æ–°**

   * `updates/sample/{table}.json` ã‚’æ•´å‚™

### 1.2 å¤‰æ›´ãƒ‘ã‚¿ãƒ¼ãƒ³ã”ã¨ã®å‡¦ç†

#### ãƒ†ãƒ¼ãƒ–ãƒ«åã®å¤‰æ›´

æ–°è¨­ â†’ ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ â†’ æ—§ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤ â†’ åˆ¶ç´„/ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ›´æ–°

#### ã‚«ãƒ©ãƒ åã®å¤‰æ›´

è¿½åŠ  â†’ ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ â†’ æ—§ã‚«ãƒ©ãƒ å‰Šé™¤ â†’ åˆ¶ç´„æ›´æ–°

#### ã‚«ãƒ©ãƒ åž‹ã®å¤‰æ›´

ä¸€æ™‚ã‚«ãƒ©ãƒ  â†’ å¤‰æ› â†’ å‰Šé™¤ â†’ åå‰å¤‰æ›´

#### åˆ¶ç´„ã®è¿½åŠ /å¤‰æ›´

æ—§åˆ¶ç´„å‰Šé™¤ â†’ æ–°åˆ¶ç´„è¿½åŠ  â†’ æ•´åˆæ€§ç¢ºèª

### 1.3 æ³¨æ„ç‚¹

* æœ¬ç•ªå‰ã«å¿…ãšãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
* å„æ®µéšŽã§ãƒ†ã‚¹ãƒˆ
* ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã®æº–å‚™
* ãƒãƒ¼ãƒ å…±æœ‰ã¨è¨˜éŒ²ã®å¾¹åº•

---

## 2. ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã®æ‰‹é †

### 2.1 æ–°è¦ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 

```bash
# updates/{ãƒ†ãƒ¼ãƒ–ãƒ«å}/add/ ã«é…ç½®
# ãƒ•ã‚¡ã‚¤ãƒ«å: {ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—}_{ãƒ†ãƒ¼ãƒ–ãƒ«å}.json
python generate_migration.py
```

ç”Ÿæˆã•ã‚ŒãŸSQLã§æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ â†’ é©ç”¨ â†’ çµæžœç¢ºèª

### 2.2 ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°

* æ›´æ–°å¯¾è±¡JSONã‚’ `update/` ã«é…ç½®
* ã‚­ãƒ¼ã‚’æ˜Žç¤º â†’ ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ â†’ SQLç¢ºèªãƒ»é©ç”¨

### 2.3 ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤

* æ¡ä»¶ç‰¹å®š â†’ SQLç”Ÿæˆ â†’ å‰Šé™¤ãƒ»çµæžœç¢ºèªï¼ˆå¤–éƒ¨ã‚­ãƒ¼æ³¨æ„ï¼‰

---

## 3. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã‚¢

### 3.1 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

```bash
pg_dump -U postgres syllabus > backup_$(date +%Y%m%d).sql
pg_dump -U postgres --schema-only syllabus > schema_$(date +%Y%m%d).sql
```

### 3.2 ãƒªã‚¹ãƒˆã‚¢

```bash
psql -U postgres syllabus < backup_YYYYMMDD.sql
psql -U postgres syllabus < schema_YYYYMMDD.sql
```

---

## 4. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 4.1 ã‚ˆãã‚ã‚‹å•é¡Œ

* **å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„é•å** â†’ å‚ç…§å…ƒã®å­˜åœ¨ç¢ºèª
* **ä¸€æ„åˆ¶ç´„é•å** â†’ é‡è¤‡ç¢ºèª
* **åž‹å¤‰æ›ã‚¨ãƒ©ãƒ¼** â†’ ãƒ‡ãƒ¼ã‚¿åž‹ã®æ•´åˆæ€§ç¢ºèª

### 4.2 ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

* ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¢ºèª â†’ ãƒªã‚¹ãƒˆã‚¢ â†’ ä¿®æ­£ â†’ å‹•ä½œç¢ºèª

---

## 5. ç›£è¦–ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### 5.1 å®šæœŸç¢ºèªé …ç›®

* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ã‚ºã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã€ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°

### 5.2 æœ€é©åŒ–ã®ç›®å®‰

* ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹åŠ£åŒ–
* ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§å•é¡Œ
* ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä¸è¶³

[ðŸ” ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã¸](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°æ‰‹é †æ›¸)