# Git 操作ガイド

[readmeへ](../README.md)

## 目次
1. [SQLiteデータベースの取り扱い](#sqliteデータベースの取り扱い)
2. [マージ時の注意点](#マージ時の注意点)
3. [Squashマージの手順](#squashマージの手順)
4. [推奨される作業フロー](#推奨される作業フロー)
5. [将来的な移行計画](#将来的な移行計画)

## SQLiteデータベースの取り扱い

### データベースファイルの位置
- データベースファイルは `db/` ディレクトリに配置されています
- データベースファイルはバージョン管理対象として扱います

### 注意点
- データベースファイルの変更は慎重に行い、必ずコミットメッセージに変更内容を記載してください
- マージ時は特に注意が必要です（以下のセクションを参照）

## マージ時の注意点

### マージ衝突の原因
SQLiteデータベースファイルは以下の理由でマージ衝突を引き起こす可能性があります：
- バイナリファイルであるため、通常のテキストベースのマージができない
- 各開発者の環境で異なるデータが存在する可能性がある

### 対処方法
1. マージ前の準備
   - 現在の作業内容をコミットする
   - データベースのバックアップを作成する

2. マージ実行時の注意
   - 通常のマージは避け、以下のSquashマージの手順に従ってください

## Squashマージの手順

### Featureブランチのマージ
1. リベース実行
   ```bash
   git checkout feature_branch
   git rebase main
   ```

2. コンフリクト発生時
   ```bash
   git checkout --ours db/syllabus.db  # メインブランチのDBを採用
   git add db/syllabus.db
   git rebase --continue
   ```

3. Squashマージ実行
   ```bash
   git checkout main
   git merge --squash feature_branch
   git commit -m "feat: ＜機能の説明＞"
   ```

### 注意点
- `--ours`オプションを使用することで、現在のブランチ（main）のデータベースファイルを採用します
- 必要に応じて、マージ後にデータの再投入を行ってください

## 推奨される作業フロー

### 新規ブランチでの作業開始時
1. メインブランチから新規ブランチを作成
2. 必要に応じてデータベースを更新
3. 開発作業の実施

### マージリクエスト作成時
1. データベース関連の変更がある場合は、その内容を明確に記載
2. マージリクエストの説明に、データベース更新の有無を明記

### マージ後の作業
1. ローカルのメインブランチを更新
2. 必要に応じてデータを再投入

## 将来的な移行計画

### PostgreSQLへの移行
- 現在はSQLiteを使用していますが、将来的にはPostgreSQLへの移行を予定しています
- 移行時期や具体的な手順については、[PostgreSQL仕様書](../docs/postgresql.md)を参照してください

### 移行に向けた注意点
- データベースの操作は可能な限りSQLAlchemyを通じて行い、特定のDBMSに依存する機能は避けてください
- 新機能の追加時は、PostgreSQLへの移行を考慮した設計を心がけてください

[🔝 ページトップへ](#git-操作ガイド) 